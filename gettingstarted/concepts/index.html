<!DOCTYPE html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="robots" content="noindex,nofollow">

        <title>PCOT concepts - PCOT Documentation</title>
    
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <link rel="stylesheet" href="../../css/lightbox.min.css">
    <link rel="stylesheet" href="../../css/site.css">

    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script>
    <script src="../../js/lightbox-plus-jquery.min.js"></script>
 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">PCOT Documentation</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Getting Started <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../" class="dropdown-item">Overview</a>
</li>
                                    
<li>
    <a href="../installrun/" class="dropdown-item">Installing and running</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">PCOT concepts</a>
</li>
                                    
<li>
    <a href="../tutorial/" class="dropdown-item">Tutorial</a>
</li>
                                    
<li>
    <a href="../inputs/" class="dropdown-item">Loading other image formats</a>
</li>
                                    
<li>
    <a href="../help/" class="dropdown-item">Getting help</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../userguide/" class="dropdown-item">Overview</a>
</li>
                                    
<li>
    <a href="../../userguide/principles/" class="dropdown-item">Operating principles</a>
</li>
                                    
<li>
    <a href="../../userguide/canvas/" class="dropdown-item">The Canvas</a>
</li>
                                    
<li>
    <a href="../../userguide/globalcontrols/" class="dropdown-item">Global Controls</a>
</li>
                                    
<li>
    <a href="../../userguide/multifile/" class="dropdown-item">Reading images from multiple files</a>
</li>
                                    
<li>
    <a href="../../userguide/expr/" class="dropdown-item">The "expr" node for mathematical expressions</a>
</li>
                                    
<li>
    <a href="../../autodocs/" class="dropdown-item">Autodocs</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Developer's Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../devguide/" class="dropdown-item">Overview</a>
</li>
                                    
<li>
    <a href="../../devguide/library/" class="dropdown-item">Using PCOT as a library</a>
</li>
                                    
<li>
    <a href="../../devguide/plugins/" class="dropdown-item">Writing PCOT plugins</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../roadmap/" class="nav-link">Roadmap</a>
                            </li>
                            <li class="navitem">
                                <a href="../issues/" class="nav-link">Known issues</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../installrun/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../tutorial/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#concepts" class="nav-link">Concepts</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#the-graph" class="nav-link">The Graph</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#the-document" class="nav-link">The Document</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#quantities" class="nav-link">Quantities</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="concepts">Concepts</h1>
<p><strong>How PCOT works (and why)</strong></p>
<p>PCOT was originally designed to help scientists and engineers analyse PanCam
data and produce useful secondary data. It acts downstream from the
Rover Operations Control Centre (ROCC) on
images which have already been processed to some extent, and is a successor to
ExoSpec <sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>. As such, its primary purpose is to generate relative reflectance
images and spectral parameter maps, although it will also be able to produce
spectra from regions of interest. Indeed, it should be flexible enough
to perform a wide range of unforeseen calculations.</p>
<p>PCOT can also handle many other kinds of data. It is particularly suited
to processing multispectral images with uncertainty and error data, and can
currently read PDS4 and ENVI formats, alongside more common RGB formats
which can be collated into multispectral images.</p>
<p>Of paramount importance is the verifiability and reproducibility of data
generated from PCOT. To this end, a PCOT document is a data product which can
be shared between users, which also fully describes how the data was generated
from the initial import to the final output. Users are encouraged to exchange
PCOT documents in addition to, or instead of, the generated images or data.</p>
<h2 id="the-graph">The Graph</h2>
<p>To achieve this, a PCOT document manipulates data in a graph - a network of
nodes, each of which takes some data, works on it, perhaps displays some
data, and perhaps outputs derived data. 
Technically speaking, this is a "directed acyclic graph": each connection
has a direction, going from the output of one node to the input
of another, and there can't be any loops.</p>
<p>As an example, consider that we might want
to overlay some kind of spectral parameter map, converted to a colour
gradient, over an RGB image (note: I'm not a geologist, I'm a software
engineer, so perhaps this is a very artificial example). One way to do it
might be this:</p>
<p><figure class="text-center"><a data-lightbox="671438grad.png" href="../671438grad.png"><img alt="An example graph" src="../671438grad.png" /></a><figcaption class="figure-caption text-center">Figure: An example graph. Click on image to expand.</figcaption></figure></p>
<p>We can see the graph in the panel on the right, showing each node as a box
with connections to other nodes (ignore the green numbers, they just show
how many times each node has run - it's a debugging aid!)
Here's what each node in the graph is doing:</p>
<ul>
<li>The <em>input 0</em> node reads input number 0 into the graph. The inputs are set up separately from the graph,
and can be multispectral images or other data (e.g. housekeeping) from outside PCOT.</li>
<li>The <em>rect</em> node lets the user draw a rectangle on the image to define a region of interest. Images
can have many regions of interest and several different kinds are available.</li>
<li>The node with 4 inputs <em>a,b,c,d</em> is an <em>expr</em> node, which 
calculates the result of a mathematical expression performed on each pixel. The node is showing the expression it
is running: <code>a$671 / a$438</code>.
This will read the bands whose wavelengths are 671nm and 438nm in the node's <em>a</em> input, and find their ratio for every pixel.
The result will be a single-band image. <em>Expr</em> nodes can perform much more complex calculations than this.</li>
<li>The <em>gradient</em> node will convert a single-band image into an RGB image with a user-defined gradient and
inset it into the RGB representation of another image - here we are insetting into the input image, using
the RGB representation used by that node.</li>
</ul>
<p>Here is another example, showing a spectral plot:</p>
<ul>
<li>The <em>input</em> node again brings a multispectral image into the graph.</li>
<li>The <em>multidot</em> node adds a number of small, circular regions of interest. Each has a different name and colour, in this case set
automatically to just numbers and random colours. Creating the regions is
as easy as clicking on the image.</li>
<li>The <em>spectrum</em> node plots a spectrogram of the regions present in the image for all the wavelengths in that image.</li>
</ul>
<p><figure class="text-center"><a data-lightbox="spec.png" href="../spec.png"><img alt="Spectrogram example" src="../spec.png" /></a><figcaption class="figure-caption text-center">Figure: Spectrogram example. Click on image to expand.</figcaption></figure></p>
<p>Here I have "undocked" the <em>spectrum</em> node's view to be a separate window for easy viewing. The spectrum can also be saved as a PDF
or converted into CSV data. I'm also showing the entire app, including the menu bar and four input buttons.</p>
<h2 id="the-document">The Document</h2>
<p>A PCOT document is a file which can be shared among users. It consists of </p>
<ul>
<li>The <strong>inputs</strong> - data loaded from sources external to PCOT. These are kept
separate from the graph, because you might want to use a different graph on
the same inputs, or the load the same inputs into a different graph. There are
currently up to four inputs, but this can easily be changed. </li>
<li>The <strong>graph</strong> - a set of nodes and connections between them which define
operations to be performed on inputs, as shown above.</li>
<li>The <strong>settings</strong> - these are global to the entire application.</li>
<li><strong>Macros</strong> - these are sets of nodes which can be used multiple times and
appear as single nodes in the graph, although each one has its own "private"
graph. Currently very experimental (and largely undocumented).</li>
</ul>
<div class="alert alert-primary" role="alert">
<p><strong>Important</strong></p>
<p>The data being sent out of the inputs into the graph is saved
and loaded with the document, so the original source data does not need
to be stored - you can send the document to someone and it will still work
even if they don't have the sources.</p>
</div>
<h2 id="quantities">Quantities</h2>
<p>All numerical quantities in PCOT - whether scalar values or pixels in images -
consist of three values: nominal value, uncertainty and data quality (DQ) bits.
Uncertainty and DQ bitss can be viewed as overlays in the canvas (PCOT's image viewer
component).</p>
<h3 id="uncertainty">Uncertainty</h3>
<p>The uncertainty is expressed as standard deviation, and is propagated through
most operations. Be careful here, however - <strong>all values are assumed to be independent.
This can lead to grossly incorrect results</strong>. For example, we could set up a graph
consisting of a node with the value <span class="arithmatex"><span class="MathJax_Preview">0\pm1</span><script type="math/tex">0\pm1</script></span>, feed it into a mathematical expression (<em>expr</em>) node
as variable *a), and set the node's expression to <span class="arithmatex"><span class="MathJax_Preview">a-a</span><script type="math/tex">a-a</script></span>:</p>
<p><figure class="text-center"><a data-lightbox="badunc.png" href="../badunc.png"><img alt="Incorrect uncertainty calculation" src="../badunc.png" /></a><figcaption class="figure-caption text-center">Figure: Incorrect uncertainty calculation. Click on image to expand.</figcaption></figure></p>
<p>The result, <span class="arithmatex"><span class="MathJax_Preview">0\pm\sqrt{2}</span><script type="math/tex">0\pm\sqrt{2}</script></span>, is a consequence of the subtraction assuming that all quantities are
independent even when they are clearly the same quantity.</p>
<h3 id="data-quality-bits">Data quality bits</h3>
<p>Each pixel in an image has a set of bits describing its quality in the source data,
which are propagated through all operations. Additionally, other DQ bits may be added
as the data moves through the graph - for example, division by zero may occur, or an operation
whose result is undefined for those values. While DQ bits are flexible, the following
are probably stable:</p>
<table>
<thead>
<tr>
<th>Bit</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>NODATA</td>
<td>no data present (typically for a particular pixel)</td>
</tr>
<tr>
<td>NOUNCERTAINTY</td>
<td>Pixel has no uncertainty (again typically for pixels)</td>
</tr>
<tr>
<td>SAT</td>
<td>Data is saturated</td>
</tr>
<tr>
<td>DIVZERO</td>
<td>A division by zero has occurred</td>
</tr>
<tr>
<td>UNDEF</td>
<td>Result of operation is undefined</td>
</tr>
<tr>
<td>COMPLEX</td>
<td>Data is real part of complex result</td>
</tr>
<tr>
<td>ERROR</td>
<td>Unspecified error</td>
</tr>
</tbody>
</table>
<p>There may also be user-defined or "test" bits for use in development.</p>
<p>Move on to <a href="../tutorial">a First Tutorial</a></p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Allender, Elyse J., Roger B. Stabbins, Matthew D. Gunn, Claire R. Cousins,
and Andrew J. Coates. 
<a href="https://www.spiedigitallibrary.org/conference-proceedings-of-spie/10789/107890I/The-ExoMars-Spectral-Tool-ExoSpec--an-image-analysis-tool/10.1117/12.2325659.short?SSO=1">"The ExoMars spectral tool (ExoSpec): An image analysis tool for ExoMars 2020 PanCam imagery."</a>
In 
<em>Image and Signal Processing for Remote Sensing XXIV</em>, vol. 10789, pp. 163-181. SPIE, 2018.
<a href="https://research-repository.st-andrews.ac.uk/bitstream/handle/10023/16973/Allender_2018_ExoMars_SPIE_107890I.pdf">link to PDF</a>&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/jquery-3.6.0.min.js"></script>
        <script src="../../js/bootstrap.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
